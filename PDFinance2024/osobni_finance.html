<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Správa osobních financí</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4 max-w-3xl">
    <h1 class="text-3xl font-bold mb-6 text-center">Správa osobních financí</h1>

    <div class="mb-6 p-4 bg-white rounded-lg shadow">
      <h2 class="text-xl font-semibold">Zůstatek: <span id="balance">0.00</span> Kč</h2>
      <p>Příjmy: <span id="totalIncome">0.00</span> Kč | Výdaje: <span id="totalExpense">0.00</span> Kč</p>
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Přidat transakci</h2>
      <div class="flex flex-col gap-4">
        <input id="description" type="text" placeholder="Popis" class="p-2 border rounded">
        <input id="amount" type="number" placeholder="Částka" class="p-2 border rounded">
        <select id="type" class="p-2 border rounded">
          <option value="income">Příjem</option>
          <option value="expense">Výdaj</option>
        </select>
        <select id="category" class="p-2 border rounded hidden">
          <option value="Jídlo">Jídlo</option>
          <option value="Bydlení">Bydlení</option>
          <option value="Doprava">Doprava</option>
          <option value="Zábava">Zábava</option>
          <option value="Ostatní">Ostatní</option>
        </select>
        <button id="addTransaction" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Přidat</button>
      </div>
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Seznam transakcí</h2>
      <div id="transactionList" class="space-y-2"></div>
    </div>

    <div>
      <h2 class="text-xl font-semibold mb-2">Graf výdajů</h2>
      <canvas id="expenseChart"></canvas>
    </div>
  </div>

  <script>
    const categories = ['Jídlo', 'Bydlení', 'Doprava', 'Zábava', 'Ostatní'];
    let transactions = [];
    let chartInstance = null;

    const descriptionInput = document.getElementById('description');
    const amountInput = document.getElementById('amount');
    const typeSelect = document.getElementById('type');
    const categorySelect = document.getElementById('category');
    const addTransactionBtn = document.getElementById('addTransaction');
    const transactionList = document.getElementById('transactionList');
    const balanceEl = document.getElementById('balance');
    const totalIncomeEl = document.getElementById('totalIncome');
    const totalExpenseEl = document.getElementById('totalExpense');

    function updateCategoryVisibility() {
      categorySelect.classList.toggle('hidden', typeSelect.value === 'income');
    }

    function updateSummary() {
      const totalIncome = transactions
        .filter(t => t.type === 'income')
        .reduce((sum, t) => sum + t.amount, 0);
      const totalExpense = transactions
        .filter(t => t.type === 'expense')
        .reduce((sum, t) => sum + t.amount, 0);
      const balance = totalIncome - totalExpense;

      balanceEl.textContent = balance.toFixed(2);
      totalIncomeEl.textContent = totalIncome.toFixed(2);
      totalExpenseEl.textContent = totalExpense.toFixed(2);
    }

    function updateTransactionList() {
      transactionList.innerHTML = '';
      transactions.forEach(t => {
        const div = document.createElement('div');
        div.className = 'flex justify-between p-2 bg-gray-50 rounded';
        div.innerHTML = `
          <span>${t.date} - ${t.description} (${t.type === 'income' ? 'Příjem' : t.category})</span>
          <span class="${t.type === 'income' ? 'text-green-500' : 'text-red-500'}">
            ${t.type === 'income' ? '+' : '-'}${t.amount.toFixed(2)} Kč
            <button onclick="deleteTransaction(${t.id})" class="ml-4 text-red-500 hover:text-red-700">Smazat</button>
          </span>
        `;
        transactionList.appendChild(div);
      });
    }

    function updateChart() {
      const ctx = document.getElementById('expenseChart').getContext('2d');
      if (chartInstance) chartInstance.destroy();

      const expenseData = categories.reduce((acc, cat) => {
        acc[cat] = transactions
          .filter(t => t.type === 'expense' && t.category === cat)
          .reduce((sum, t) => sum + t.amount, 0);
        return acc;
      }, {});

      chartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: categories,
          datasets: [{
            data: categories.map(cat => expenseData[cat] || 0),
            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Výdaje podle kategorií' }
          }
        }
      });
    }

    function addTransaction() {
      const description = descriptionInput.value;
      const amount = parseFloat(amountInput.value);
      if (!description || isNaN(amount) || amount <= 0) return;

      const transaction = {
        id: Date.now(),
        description,
        amount,
        type: typeSelect.value,
        category: typeSelect.value === 'expense' ? categorySelect.value : null,
        date: new Date().toLocaleDateString('cs-CZ')
      };

      transactions.push(transaction);
      descriptionInput.value = '';
      amountInput.value = '';
      updateSummary();
      updateTransactionList();
      updateChart();
    }

    window.deleteTransaction = function(id) {
      transactions = transactions.filter(t => t.id !== id);
      updateSummary();
      updateTransactionList();
      updateChart();
    };

    typeSelect.addEventListener('change', updateCategoryVisibility);
    addTransactionBtn.addEventListener('click', addTransaction);

    updateCategoryVisibility();
  </script>
</body>
</html>